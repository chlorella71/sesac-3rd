<!DOCTYPE html>
<html layout:decorate="~{layout/layout}">
<div layout:fragment="content" class="container my-3">
    <!-- 블로그 헤더 섹션 -->
    <div th:replace="~{layout/fragments/blog-header :: blogHeader(blogResponseDTO=${blogResponseDTO})}"></div>

    <div class="row">
        <!-- 왼쪽 사이드바 (카테고리 목록) -->
        <div th:replace="~{layout/fragments/sidebar :: sidebar(${folderCategoryList}, ${blogResponseDTO})}"></div>

        <!-- 메인 컨텐츠 영역 - 이 영역만 동적으로 교체됨 -->
        <div id="content-area" class="col-md-9">
            <!-- 초기 블로그 메인 컨텐츠 -->
            <div th:replace="~{blog/blog_content :: blogContent(${blogResponseDTO})}"></div>
        </div>
    </div>

    <!-- 모달 영역 -->
    <div th:replace="~{layout/fragments/modals :: blogModals}"></div>

    <!-- 블로그 소유자 정보 (JavaScript에서 접근용) -->
    <meta name="blog-owner-email" th:content="${blogResponseDTO.email}" />
    <meta name="current-user-email" sec:authorize="isAuthenticated()" th:content="${#authentication.principal.username}" />

    <!-- csrf 토큰을 로그인한 사용자에게만 추가 -->
    <th:block sec:authorize="isAuthenticated()">
        <meta name="_csrf" th:content="${_csrf.token}" />
        <meta name="_csrf_header" th:content="${_csrf.headerName}" />
    </th:block>

</div>

<!-- 폴더 계층 구조를 위한 추가 스타일 -->
<th:block layout:fragment="style">
    <style>
        /* 폴더 계층 구조 관련 스타일 */
        .folder-children {
            padding-left: 1rem;
            margin-top: 0.5rem;
            border-left: 1px solid #dee2e6;
            margin-left: 0.25rem;
        }

        .folder-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.25rem 0;
            margin: 0.25rem 0;
            border-radius: 0.25rem;
            transition: background-color 0.2s;
        }

        .folder-item:hover {
            background-color: rgba(0, 0, 0, 0.03);
        }

        .add-subfolder {
            margin-right: 0.25rem;
            color: #28a745;
        }

        .add-subfolder:hover {
            color: #218838;
        }

        .folder-name small {
            font-size: 0.75rem;
            opacity: 0.7;
        }

         /* 포스트 목록 스타일 */
        .post-item {
            border-left: 3px solid #007bff;
            margin-bottom: 10px;
            transition: all 0.2s ease;
        }

        .post-item:hover {
            background-color: #f8f9fa;
            transform: translateX(3px);
        }

        .post-item.draft {
            border-left-color: #6c757d;
        }

        .post-date {
            font-size: 0.8rem;
            color: #6c757d;
        }

        .post-content-preview {
            color: #6c757d;
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
        }

        .folder-link.active, .category-link.active {
            font-weight: bold;
            color: #007bff;
        }

        .draft-badge {
            background-color: #6c757d;
            color: white;
            font-size: 0.7rem;
            padding: 2px 5px;
            border-radius: 3px;
            margin-left: 5px;
        }
    </style>
</th:block>

<!--<th:block layout:fragment="script" type='text/javascript'>-->
<!--    <script type="module" src="/js/modalHandler.js"></script>-->
<!--</th:block>-->


<!-- javascript 파일 연결 - 페이지별 JS 파일 사용 -->
<th:block layout:fragment="script" type='text/javascript'>
    <script type="module" src="/js/pages/blog-enhanced.js"></script>
</th:block>

</html>